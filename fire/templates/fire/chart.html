{% extends 'layouts/master.html' %} 
{% load static %} 
{% load i18n %}

{% block title %}Weather Conditions Chart{% endblock title %}

{% block vendor_css %}
{{ block.super }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="{% static 'vendor/libs/apex-charts/apex-charts.css' %}" />
{% endblock vendor_css %}

{% block content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">Weather Conditions</h5>
                    <div class="dropdown">
                        <button class="btn btn-primary dropdown-toggle" type="button" id="weatherMetricDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Temperature
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="weatherMetricDropdown">
                            <li><a class="dropdown-item" href="#" data-metric="temperature">Temperature</a></li>
                            <li><a class="dropdown-item" href="#" data-metric="humidity">Humidity</a></li>
                            <li><a class="dropdown-item" href="#" data-metric="wind_speed">Wind Speed</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <div id="weatherChart" style="min-height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block vendor_js %}
{{ block.super }}
<script src="{% static 'vendor/libs/apex-charts/apexcharts.js' %}"></script>
{% endblock vendor_js %}

{% block page_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Weather data from context
    const weatherData = {{ weather_data|safe }};
    
    // Chart options
    const options = {
        series: [{
            name: 'Temperature',
            data: weatherData.temperature
        }],
        chart: {
            type: 'line',
            height: 400,
            toolbar: {
                show: false
            },
            zoom: {
                enabled: true
            },
            animations: {
                enabled: true,
                easing: 'easeinout',
                speed: 800
            }
        },
        colors: ['#696cff'],
        stroke: {
            curve: 'smooth',
            width: 3,
            lineCap: 'round'
        },
        grid: {
            borderColor: '#e7e7e7',
            padding: {
                top: 10,
                right: 10,
                bottom: 10,
                left: 10
            }
        },
        markers: {
            size: 4,
            colors: ['#696cff'],
            strokeColors: '#fff',
            strokeWidth: 2,
            hover: {
                size: 6
            }
        },
        xaxis: {
            categories: weatherData.dates,
            labels: {
                style: {
                    colors: '#697a8d',
                    fontSize: '12px'
                },
                rotate: -45,
                rotateAlways: true,
                maxHeight: 60
            },
            axisBorder: {
                show: true,
                color: '#e7e7e7'
            },
            axisTicks: {
                show: true,
                color: '#e7e7e7'
            }
        },
        yaxis: {
            labels: {
                style: {
                    colors: '#697a8d',
                    fontSize: '12px'
                }
            },
            axisBorder: {
                show: true,
                color: '#e7e7e7'
            },
            axisTicks: {
                show: true,
                color: '#e7e7e7'
            }
        },
        tooltip: {
            theme: 'light',
            x: {
                format: 'dd MMM yyyy HH:mm'
            },
            y: {
                formatter: function(value) {
                    return value + '°C';
                }
            }
        },
        legend: {
            show: true,
            position: 'top',
            horizontalAlign: 'right',
            fontSize: '14px',
            markers: {
                width: 12,
                height: 12,
                radius: 12
            }
        }
    };

    // Initialize chart
    const chart = new ApexCharts(document.querySelector("#weatherChart"), options);
    chart.render();

    // Handle metric selection
    document.querySelectorAll('.dropdown-item').forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            const metric = this.dataset.metric;
            const metricName = this.textContent;
            const metricData = weatherData[metric];
            let unit = '';
            
            // Set appropriate unit based on metric
            switch(metric) {
                case 'temperature':
                    unit = '°C';
                    break;
                case 'humidity':
                    unit = '%';
                    break;
                case 'wind_speed':
                    unit = ' km/h';
                    break;
            }

            // Update chart
            chart.updateOptions({
                series: [{
                    name: metricName,
                    data: metricData
                }],
                tooltip: {
                    y: {
                        formatter: function(value) {
                            return value + unit;
                        }
                    }
                }
            });

            // Update dropdown button text
            document.getElementById('weatherMetricDropdown').textContent = metricName;
        });
    });
});
</script>
{% endblock page_js %}
```